---
title: "Media Handling"
weight: 4
---

# Media Handling

Polyclaw supports sending and receiving files, images, audio, and video through its messaging channels.

## Media Classification

The `media/classify.py` module maintains a MIME type registry that classifies files into categories:

| Category | Examples |
|---|---|
| **Image** | JPEG, PNG, GIF, WebP, SVG |
| **Audio** | MP3, WAV, OGG, FLAC |
| **Video** | MP4, WebM, MOV |
| **File** | PDF, DOCX, XLSX, ZIP, etc. |

## Directory Structure

```
~/.polyclaw/media/
  incoming/     # Downloaded from channels
  outgoing/     # Generated by the agent
    pending/   # Awaiting delivery
    sent/      # Successfully delivered
    error/     # Failed delivery
```

## Incoming Media

When a user sends a file through a messaging channel:

1. The Bot Framework SDK provides the attachment metadata
2. `incoming.py` downloads the file from the Bot Framework CDN
3. The file is saved to `media/incoming/` with its original filename
4. A media-aware prompt is built that describes the file to the agent
5. For images, the agent can analyze the visual content
6. For documents, the content is extracted when possible

## Outgoing Media

When the agent generates content that includes file references:

1. `incoming.py` extracts file paths from the response text using regex patterns
2. Referenced files are copied to `media/pending/`
3. During proactive message delivery, pending files are attached
4. Successfully sent files are moved to `media/sent/`
5. Files that fail to send are moved to `media/error/`

## Media in Web Chat

The web dashboard serves media files via the `/media/*` endpoint. Incoming and outgoing files are accessible for viewing and downloading through the chat interface.

## Supported Operations

| Operation | Description |
|---|---|
| Receive images | View and analyze images sent by users |
| Receive documents | Process uploaded documents |
| Send files | Attach generated files to responses |
| Image analysis | Describe image contents (via LLM vision) |
